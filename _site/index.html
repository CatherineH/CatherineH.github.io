
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Catherine's Auxiliary Brain</title>
    
    <meta name="author" content="Catherine Holloway">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="http://CatherineH.github.io/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="http://CatherineH.github.io/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Catherine's Auxiliary Brain</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/categories">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/pages">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/tags">Tags</a></li>
      	
      
    
  



          </ul>
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/07/07/troubleshooting-windows-dll-imports-in-python">Troubleshooting Windows dll imports in Python </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>07 July 2016</span>
    </div>
    <div class="content">
      
<p>I stumbled over some fairly obvious things when importing a Windows dll in python this
 morning. I’m writing this post to shorten the amount of time I spend reading Stack
 Overflow next time.</p>

<p>The code I will be using for this post is:</p>

<pre><code>from ctypes import cdll
lib = cdll.LoadLibrary("mydll.dll")
</code></pre>

<h1 id="are-you-using-the-static-version-of-the-library-instead-of-the-dynamic-version">Are you using the static version of the library instead of the dynamic version?</h1>

<p>ctypes can only import dynamic libraries. If you attempt to load a static library, you
 will get the error:</p>

<pre><code>  File "Python35\Lib\ctypes\__init__.py", line 425, in LoadLibrary
    return self._dlltype(name)
  File "Python35\Lib\ctypes\__init__.py", line 347, in __init__
    self._handle = _dlopen(self._name, mode)
OSError: [WinError 193] %1 is not a valid Win32 application
</code></pre>

<p>Make sure the dynamic <em>.dll</em> file is loaded, not the static <em>.lib</em> file. If only
static libraries are provided, it might be possible to recompile as a dynamic library,
but I did not try this.</p>

<h1 id="are-you-using-32-bit-python-with-a-64-bit-library">Are you using 32 bit python with a 64 bit library?</h1>

<p>Using a 64-bit dll with 32 bit python results in the error:</p>

<pre><code>   File "Python35\lib\ctypes\__init__.py", line 429, in LoadLibrary
    return self._dlltype(name)
  File "Python35\lib\ctypes\__init__.py", line 351, in __init__
    self._handle = _dlopen(self._name, mode)
OSError: [WinError 193] %1 is not a valid Win32 application
</code></pre>

<p>To solve this, download the <a href="https://www.python.org/downloads">Windows x86-64</a> version
 of python, and configure your IDE to use this python interpreter.</p>

<h1 id="are-you-using-the-32-bit-version-of-ctypes-with-a-64-bit-version-of-python">Are you using the 32 bit version of ctypes with a 64 bit version of python?</h1>

<p>If you install the 64 bit version of python alongside the 32 bit version, it is likely
 that your environment variables will still be set up to point the PYTHONPATH to the
 32 bit versions of the python libraries.</p>

<p>This will result in the error:</p>

<pre><code>   File "example.py", line 1, in &lt;module&gt;
    from ctypes import cdll
  File "Python35\lib\ctypes\__init__.py", line 7, in &lt;module&gt;
    from _ctypes import Union, Structure, Array
ImportError: DLL load failed: %1 is not a valid Win32 application.
</code></pre>

<p>To fix this, I set the PYTHONPATH in my IDE to be <em>Python35\Lib\;Python35\libs;
Python35\DLLs</em></p>

<p>On Windows, with python &gt; 3.5, it is important to add the DLL folder; the <em>_ctypes</em>
module lives in there now.</p>


    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/06/07/mimicking-udev-rules-with-pyserial">Mimicking udev rules with PySerial </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>07 June 2016</span>
    </div>
    <div class="content">
      
<p>My research group in grad school had an unfortunate culture of stealing equipment from
other people’s experiments when they weren’t around. I participated in this culture as well,
 but I tried to replace the things I took before they returned. However, this did not
 spare me from the ire of a Postdoc<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> who pointed out that windows assigns
  device names by serial number, thus my replacing a power meter with an identical
  copy had caused him an hour of debugging time until he opened up the device manager.</p>

<p>Later, out of grad school and working on robots with even more hardware, I discovered
the joy of writing udev rules and spared myself many hours of plugging in usb cables to
see what they enumerate as.</p>

<p>I’m now out of robotics and back in experimental physics. Most
experimental physicists aren’t linux users, so a lot of scientific equipment is sold with
 drivers which are only functional on Windows.</p>

<p>I had reverted back to plugging and unplugging cables, until the other experimental
physicist at work switched out the hardware in my experimental setup overnight. After
I had calmed down, decided to find another way.</p>

<p>Here’s my solution. <a href="http://pyserial.readthedocs.io/">PySerial</a> has a lovely tool
called <em>list_ports</em> which will list a
 bunch of handy information about the available com ports. By matching the vendor and
 product IDs, (or in the case of devices that both use the FTDI FT232R chip, also the 
 serial number) I can guess the devices:</p>

<pre><code>from serial import Serial
from serial.tools import list_ports

# hardware is represented as a tuple of (vid, pid, serial_number (if needed), baud_rate)
HARDWARE = {'temperature_controller': (1027, 24577, 'serial1', 115200),
            'counter': (1027, 24577, 'serial2', 19200),
            'motor_controller': (5824, 1155, 9600),
            'laser': (10682, 2, 115200)}

def map_hardware():
    com_ports = dict()
    for key, value in HARDWARE.items():
        found_port = False
        for port in list_ports.comports():
            if len(value) &gt; 3:
                if port.vid == value[0] and port.pid == value[1] and port.serial_number == value[2]:
                   found_port = True
                   com_ports[key] = port.device
                   break
            else:
                if port.vid == value[0] and port.pid == value[1]:
                   found_port = True
                   com_ports[key] = port.device
                   break
        if not found_port:
            raise RuntimeError("device matching ids for key: ", key, " not found")
    return com_ports

ports = map_hardware()
handles = dict()

for key in ports.keys():
    handles[key] = Serial(ports[key], HARDWARE[key][-1])
</code></pre>

<p>This is a simplification. I import modules from <a href="https://github.com/Galvant/InstrumentKit">InstrumentKit</a> to
 do the actual communication rather than writing the commands directly to the handles.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Brendon, if you’re reading, I’m still sorry about this. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/05/24/seaborn-pairgrid-tips">Hacking Seaborn Grid Plots </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>24 May 2016</span>
    </div>
    <div class="content">
      
<p>Seaborn is a wonderful python package for creating statistical plots like 
those found in R. Although the documentation and API does not expose much, 
the modules are built on top of matplotlib, a versatile plotting library. 
Matplotlib has an incredible amount of customization, if you’re willing to 
dig far enough. My goal with this post is simply to document the 
customizations I have encountered. The changes are made on the ‘iris’ demo.</p>

<h2 id="empty-axes">Empty Axes</h2>

<p>Using seaborn with the default ubuntu matplotlib package (python-matplotlib) 
will result in plots with empty axes:</p>

<p><img src="https://raw.githubusercontent.com/CatherineH/CatherineH.github.io/master/_posts/images/seaborn_plots/empty_axes.png" alt="empty axes example" /></p>

<p>To resolve this, matplotlib must be updated past version 1.3:</p>

<pre><code>$ sudo apt-get install libfreetype6-dev
$ sudo pip install --upgrade matplotlib

</code></pre>

<h2 id="custom-data-labels">Custom Data Labels</h2>

<p>Seaborn will take the keys from the dataframe as the x and y axes labels, and
 assign labels only if the subplots are around the left and bottom sides of 
 the grid. Replacing them means dipping down to the axes level:</p>

<pre><code>import seaborn as sns; sns.set(style="ticks", color_codes=True)
iris = sns.load_dataset("iris")
g = sns.pairplot(iris, hue='species')
replacements = {'sepal_length': r'$\alpha$', 'sepal_width': 'sepal',
                'petal_length': r'$\beta$', 'petal_width': 'petal',
                'versicolor': 'bloop'}

for i in range(4):
    for j in range(4):
        xlabel = g.axes[i][j].get_xlabel()
        ylabel = g.axes[i][j].get_ylabel()
        if xlabel in replacements.keys():
            g.axes[i][j].set_xlabel(replacements[xlabel])
        if ylabel in replacements.keys():
            g.axes[i][j].set_ylabel(replacements[ylabel])
</code></pre>

<p>Similarly, the hue categories are taken from the values in the dataframe. 
Most of the template graphs (such as pairplot), add a legend to the top level
 figure on being called, and this makes it difficult to edit.</p>

<p>In addition, the matplotlib <em>Figure</em> object does not provide a <em>get_legend()</em>
 method. Instead, it is possible to access via <em>get_children()</em>. The legend 
 is the last artist added, so it will be at index -1:</p>

<pre><code>for i in range(len(g.fig.get_children()[-1].texts)):
    label = g.fig.get_children()[-1].texts[i].get_text()
    if label in replacements.keys():
        g.fig.get_children()[-1].texts[i].set_text(replacements[label])
</code></pre>

<p>This is the resulting graph:</p>

<p><img src="https://raw.githubusercontent.com/CatherineH/CatherineH.github.io/master/_posts/images/seaborn_plots/labels_output.png" alt="renaming labels example" /></p>

<h2 id="moving-the-legend">Moving the Legend</h2>

<p>There are plenty of ways to place a legend in a figure when it is created, 
but moving the legend once it is already in the figure is a different story. 
The one method I’ve found is to move the legend’s anchor using 
<em>set_bbox_to_anchor</em>. These numbers seem to be expressed as a function of the
 size of the total figure, and are expressed as (left, bottom, width, height)
 . Since the figure expands to fill the required space of all the artists, 
 width and height can be zero. So, the following code will put the legend in 
 the middle in the y direction but over right edge of the figure:</p>

<pre><code>g.fig.get_children()[-1].set_bbox_to_anchor((1.1, 0.5, 0, 0))
</code></pre>

<p><img src="https://raw.githubusercontent.com/CatherineH/CatherineH.github.io/master/_posts/images/seaborn_plots/legend_moved_output.png" alt="moved legend example" /></p>


    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/music/2016/05/20/stuff-i-bought-on-bandcamp-in-may">Stuff I bought on Bandcamp in May </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>20 May 2016</span>
    </div>
    <div class="content">
      
<p>This month I bought three fantastic albums an an EP on my favourite DRM-free platform:</p>

<h1 id="sunburst---fragments-of-creation">Sunburst - Fragments of Creation</h1>

<p><a href="https://innerwound.bandcamp.com/album/fragments-of-creation"><img src="https://f4.bcbits.com/img/a1507589857_14.jpg" alt="Sunburst - Fragments of Creation" /></a></p>

<p>I am aware of only three things that my husband loves that I think are worse than
<a href="http://fivethirtyeight.com/features/how-do-you-put-out-a-subterranean-fire-in-a-mountain-of-trash">subterranean trash fires</a>:
Slaughterhouse Five, Jupiter Ascending, and <em>Dream Theater</em>’s latest album, <strong>The Astonishing</strong>. I love Dream Theater,
and think that their other two albums since Portnoy’s departure rank just under Images and Words, but listening to
<strong>The Astonishing</strong> gave me DT fatigue. So I was hesitant to listen to <strong>Fragments of Creation</strong> by <em>Sunburst</em> when I
read that it was marketed as an album for DT fans.</p>

<p>But <strong>Fragments of Creation</strong> was worth waking up for - it’s like the frenetic playing of <em>Fleshgod Apocalypse</em> with
triumphant DT melodies, guitar work and Labrie’s singing style. There are quite a few other progressive and metal influences:
the fast synthesizer arpeggios that sound like songs off of <em>Asia</em>’s <strong>Aura</strong>, <em>TesseracT</em> djent, and <em>Rhapsody of Fire</em>
choral breaks. There are still some fresh ideas - I really like the xylophones in the background.</p>

<p>The singing often verges on Celine Dion-level corniness with all of the tremolos, or descends into <em>Disturbed</em> whining.
The lyrics aren’t worth paying attention to: a lot of it is generic nu-metal stuff about pain and abandonment. The key
change in <strong>Lullaby</strong> attempts to keep a song that had already expressed all of its ideas going for another 30 seconds.
Finally, the playing isn’t quite tight, but the songs are fun enough that it doesn’t detract from the whole product.</p>

<p>The album is not perfect, but it is a much better DT album than DT’s last. Ravenskill who?</p>

<h1 id="vektor---terminal-redux">Vektor - Terminal Redux</h1>

<p><a href="https://vektor.bandcamp.com/album/terminal-redux"><img src="https://f4.bcbits.com/img/a0144143476_14.jpg" alt="Vektor - Terminal Redux" /></a></p>

<p><em>Vektor</em>, the band that made me a thrash-metal convert, released <strong>Terminal Redux</strong>, a gothic space-opera concept album.
 It is as technical, ferocious and fascinating as their last two albums, but the addition of a cohesive storyline makes this album special.</p>

<p>The story is about some unspeakable evil plotting revenge on the civilization that punished it for previous crimes. Like
 the last <em>Ghost</em> album, several tracks have gospel choir singing in a positive key about the reincarnation of this
 great evil, which is utterly delightful. Vektor venture into slower territory on <strong>Collapse</strong>, which don’t quite hold
 my attention at slower speeds, though the interaction between counter melodies are still interesting.</p>

<p>But <strong>Collapse</strong> is the one weak song on a substantial album.</p>

<h1 id="bent-knee---say-so">Bent Knee - Say So</h1>

<p><a href="https://bentknee.bandcamp.com/album/say-so"><img src="https://f4.bcbits.com/img/a2913975342_14.jpg" alt="Bent Knee - Say So" /></a></p>

<p><strong>Say So</strong> is a more pop, accessible, and fantastic sequel to <em>Bent Knee</em>’s 2014 album <strong>Shiny Eyed Babies</strong>. Although
Bent Knee are called art-rock, I think of them as more like progressive pop/jazz music. The lead singer Courtney Swain
can channel powerful Chanson emotions like <em>Edith Piaf</em>, but with all of the avant-garde, modern flourishes of a singer
like <em>Kimbra</em>. The album starts off with a deeply unsettling song reminiscent of Shiny Eyed Babies’ <strong>Way Too Long</strong>,
about foreign liquids covering or flowing uncontrollably out of your body, except this time tar instead of oil and toxic
gas, then delves into very female-centric themes. There are songs about the pre-pubescent angst of female childhood: I
think the song <strong>Leak Water</strong> is about feeling like one of the peeing dolls that were popular in the 90s and the song
<strong>Counsellor</strong> evokes memories of the emotional distance and bullying of my childhood peers. Other songs cover
dissatisfaction with domestic life; lyrics on multiple songs mention dreaming of love and adventure while doing mundane
things like driving kids around. <strong>Commercial</strong> and <strong>Good Girl</strong> are deeply sympathetic feminist anthems that should show
 <em>Meghan Trainor</em> and <em>Jennifer Lopez</em> how it’s done.</p>

<p>This album should be taken as a blueprint for a modern pop masterpiece - the songs can make you feel as excited as a
<em>Carly Rae Jepsen</em> song, but the lyrics are as clever as something written by <em>Sloan</em>. This album combines the
melancholy plaints of <em>Melanie Martinez</em> with the experimentation of <em>Zappa</em>, and the end result is simply flawless.</p>

<p>If nothing else, the album is worth it to hear a sung five-note arpeggio of the word hyperloop.</p>

<h1 id="gorguts---pleiades-dust">Gorguts - Pleiades’ Dust</h1>

<p><a href="https://gorguts.bandcamp.com/album/pleiades-dust"><img src="https://f4.bcbits.com/img/a1779181077_14.jpg" alt="Gorguts - Pleiades’ Dust" /></a></p>

<p>All your favourite <em>Gorguts</em> elements are back in this 30-minute track: discordant guitar chords, growling vocals, and
anxious drumming. Gorguts have been pretty consistent with their sound and quality over the past 25 years, if you liked
<strong>Obscura</strong>, you’ll like this. The track runs a gamut of emotions, or at least emotions defined by Gorguts, which makes
up for it not being a full album.</p>


    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/music/2016/05/17/music-people-recommend-to-me">Music People Recommend to me </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>17 May 2016</span>
    </div>
    <div class="content">
      
<p>Being a snobby music fan, I love music recommendations even when inevitably don’t love it as much as the recommender. Here are my thoughts on music people have recommended to me recently; please send me more recommendations!</p>

<h1 id="ensiferum">Ensiferum</h1>

<p>In response to my <em>Bathory</em> review, Alex M. suggested Finnish Viking metal band Ensiferum. Their debut album appeared in 2001, a full 13 years after Bathory’s <strong>Blood Fire Death</strong>. Their sound doesn’t explore new territory, but it is cleaner and more listenable than Bathory.</p>

<p>Though the Ensiferum discography is fairly consistent it quality, there were a few albums I didn’t like. <strong>Dragonheads</strong> (2006) was too ambitious, and is not quite polished. They used synthesized wind instruments, the singing is out of tune, the songs change tone all the time, the volumes aren’t balanced in a way to make the hard groves work. I thought their latest album, <strong>One Man Army</strong> (2015), which alternates between some lame country-western style and rage songs, was boring.</p>

<p>However, the albums where Ensiferum embraces the camp and fun of pretending to be vikings with electric guitars are really fun. I normally don’t like covers, but their cover of <strong>Battery</strong> has usurped the original in my brain. It’s amusing to hear such traditional pop melodies mixed with power metal - the melody of <strong>Vanderum</strong> reminds me of the chorus of <strong>Doesn’t Really Matter</strong> by <em>Janet Jackson</em>, but so far no one agrees with me:</p>

<p><a href="https://www.youtube.com/watch?v=ld_UXfJEXMU"><img src="http://img.youtube.com/vi/ld_UXfJEXMU/0.jpg" alt="Youtube ScreenShot" /></a></p>

<p>I’m definitely going to see this band live the next time they’re in SoCal.</p>

<h1 id="loxley">Loxley</h1>

<p>Thomas E. recommended a one-EP heavy metal band  out of Ottawa called Loxley. Thomas bought their 1991 EP Better Late than Never off of one of his coworkers, who was related to someone in the band. It pains me to say, because I want to support Canadian music, it’s not very good. It’s not inventive for the time, and it sounds like it was recorded in a cathedral. If any members of Loxley are reading this, though I didn’t like this EP, Thomas clearly loved it and listened to the EP many times over the years, enough to recommend it in 2016.</p>

<h1 id="steve-vai">Steve Vai</h1>

<p>I probably should have known about guitar prodigy Steve Vai prior to Ben C.’s recommendation, but 80s and 90s solo acts are a big gap in my musical awareness. Although I was initially dismissive of Vai, I’m glad I revisited his discography.</p>

<p>My favourite album in Vai’s discography is <strong>Fire Garden</strong> (1996), though its greatness is due to pulling in the best ideas of other contemporary bands. <strong>Aching Hunger</strong> uses the synthetic music sampling <em>Yes</em> introduced in the 80s. <strong>Brother</strong> is a dramatic ballad that could have come from <em>Toto</em>. The oddest cut is an <em>accidental</em> cover of <strong>One Night in Bangkok</strong> from the <em>ABBA/Tim Rice</em> musical <em>Chess</em>. According to the internet, David Lee Roth asked Vai to transcribe the guitar solo intro, which he didn’t end up using until a decade later when he dug it out, forgot that he hadn’t composed the solo, and turned it into a full song. The resulting song is honestly better than the original because it isn’t immediately followed by campy sing-talking about liking chess more than sex.</p>

<p>Although Vai’s instrumentals are fantastic, there’s a lot of garbage in his discography. Vai’s managers need to lock the sound samples out of his mixing computer. Vai is a fan of letting animals (like on <strong>Bad Horsie</strong>), children (like on <strong>Ya Yo Gek</strong>), and people with bad vocal fry (like on <strong>Kill the Guy</strong>) onto his tracks. On his interludes, he either regresses to the maturity level of a ten year old, or espouses a very un-metal philosophy of positive thinking. He preaches being happy and nice all the time, then makes fun of Britney Spears while playing live. I guess negativity is only bad when it’s not directed at you? His singing is passable, but at its worst is like the singing of the B52’s <em>Fred Schneider</em> without any of the charm.</p>

<p>Steve Vai is one of these talented guys with a career since the early 80s who appears in all sorts of interesting places. He played with <em>Zappa</em>, collaborated with <em>Ozzy</em>, and has appeared most recently on the new <em>M83</em> album <strong><a href="https://www.youtube.com/watch?v=U3YZTYXftzg">Junk</a></strong>. Listening to his discography is like a talented, curated tour of  rock guitar of the 80s and 90s, and I hope he continues to pop up in unusual places well into the future.</p>


    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/music/2016/04/29/stuff-i-bought-on-bandcamp-in-april">Stuff I bought on Bandcamp in April </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>29 April 2016</span>
    </div>
    <div class="content">
      
<p>Here’s the stuff I bought on Bandcamp for the month of April:</p>

<h1 id="tengger-cavalry---mountain-side-ep">Tengger Cavalry - Mountain Side EP</h1>

<p><a href="https://tenggercavalry.bandcamp.com/album/mountain-side-ep"><img src="https://f4.bcbits.com/img/a0624661730_14.jpg" alt="Tengger Cavalry Mountain Side" /></a></p>

<p><strong>Tengger Cavalry</strong> is a New York-based metal band that incorporates traditional mongolian instruments and throat singing into some very fast metal. I first heard of them when their 2014 album <strong>Ancient Call</strong> was released, instantly fell in love with the band, and forced it on anyone in my social circle with even a passing interest in metal.</p>

<p>Although I skipped over their 2015 album <strong>Blood Sacrifice Shaman</strong>, their new Mountain Side EP, and it fit within my bandcamp budget for April. For 9 USD you get 11 tracks, but only two are full <em>new</em> songs. Both new songs focus more on the folk side of folk-metal Tengger Cavalry’s previous albums, and the recording and production quality is better. However, the songs sound a little too similar, and don’t have a good ending: <strong>Mountain Side</strong> ends abruptly and <strong>Krutaya Gora</strong> fades out.</p>

<p>The other songs in the EP are not even worth including: there’s a club mix of <strong>Mountain Side</strong> that isn’t fast enough to dance to, an instrumental version which adds nothing because the throat singing on Tengger Cavalry tracks is practically a sixth instrument, a live version with a distracting yell of “everybody fucking move”, and an acoustic version that turns what was metal into country-western.</p>

<p>The highlights on this album are the new version of War Horse, which sounds to me like a completely different (but better!) song, and the bonus jam tracks.</p>

<p>The Mountain Side EP is not a particularly good value for money, but I have gotten so much enjoyment out of <strong>Ancient Call</strong> and I like the direction Tengger Cavalry seems to be heading in so I don’t mind contributing towards their next release.</p>

<h1 id="sourvein---aquatic-occult">Sourvein - Aquatic Occult</h1>

<p><a href="https://sourvein.bandcamp.com/album/aquatic-occult"><img src="https://f4.bcbits.com/img/a2799975375_14.jpg" alt="Sourvein Aquatic Occult" /></a></p>

<p>Sourvein is a sludge metal band (which as far as I can tell is slower, more distorted stoner metal) from North Carolina. I loved their last album <strong>Black Fangs</strong>.</p>

<p><strong>Aquatic Occult</strong> is 14 nautical-themed track. The singing style on this album is different than Sourvein’s older albums, it seems more anemic and doesn’t quite match the tone or beat of the instrumentals.</p>

<p>However, there are few tracks with harsher vocals which are quite good. <strong>Ocypuss</strong> and especially <strong>Aquanaut</strong> are absolutely hypnotic. <strong>Urchins</strong> contains some awesome atmospheric guitar melodies like those that <strong>Baroness</strong> has become famous for, but the track is far too short.</p>

<p><strong>Aquatic Occult</strong> has a few highlights, but <strong>Black Fangs</strong> was better.</p>

<h1 id="fall-of-every-sparrow---ophir-ep--beautiful-fiction-single">Fall of Every Sparrow - Ophir EP &amp; Beautiful Fiction Single</h1>

<p><a href="http://music.basickrecords.com/album/beautiful-fiction"><img src="http://f4.bcbits.com/img/a3462608377_14.jpg" alt="FOES Beautiful Fiction" /></a></p>

<p><a href="https://fallofeverysparrow.bandcamp.com/album/ophir"><img src="https://f4.bcbits.com/img/a0096047644_14.jpg" alt="FOES Ophir" /></a></p>

<p>Last month the music video for <strong>Beautiful Fiction</strong> by a band called <strong>FOES</strong> (Fall of Every Sparrow) caught my eye, so this month I bought the single and FOES other bandcamp release, an EP released in 2014 called <strong>Ophir</strong>. This EP is an unexpected gem. It reminds me of post-Porcupine Tree <strong>Steve Wilson</strong>, though as a Canadian that might be influenced by the accent.</p>

<p>Like post-Porcupine Tree <strong>Steve Wilson</strong>, this music is introspective and immediately emotionally relatable, which is uncommon from an alternative progressive rock band. The tracks sound a bit sonically full, verging on shoe-gazy. The unclean vocal bits effectively emotionally compliment the clean bits and are used sparingly. The melodies are accessible, but there’s enough complexity in the counter melodies and rhythm to keep the songs interesting.</p>

<p>However, this emotional accessibility occasionally goes overboard. The opening lyrics on <strong>The First Rook To…</strong> are trite. It’s a shame, because the rest of the song’s lyrics are bit more subtle and poetic. I think the song would have been better without lyrics in the first section, because the rest of the song is fantastic. I especially liked the triplets in the piano counter melody.</p>

<p>Their latest output <strong>Beautiful Fiction</strong> is also great, it sounds like the band are experimenting a bit with syncopation, but kept a lot of the elements that I liked from <strong>Ophir</strong>. I’m looking forward to whatever comes next from FOES.</p>

<p>On another note, it drives me crazy when bands change the punctuation in their titles. I take great, possibly neurotic, care in keeping my music organized and now the FOES tracks don’t stack up nicely in VLC.</p>

    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/04/27/controlling-an-optical-switch-via-arduino-teensy">Controlling an Optical Switch via Arduino (Teensy) </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>27 April 2016</span>
    </div>
    <div class="content">
      
<p>Aside from fingerprints, there is nothing more annoying, or more damaging to optics equipment than unplugging and
plugging in fiber optics. Every time a fiber tip or port is exposed to air, there’s a chance of getting gross human skin
 cells on places where tightly focused high-power light might incinerate them, yet, so many experiments require routing
 light. Wouldn’t it be nicer if a robot did the switching for you at 2 am while your gross dust and sweat producing body
  is sleeping?</p>

<p>In experiments, I accomplish this using a teensy LC and a DiCon optical switch.</p>

<h1 id="electonics-side">Electonics Side</h1>

<p>The optical switch I use is a <a href="http://www.diconfiberoptics.com/products/scd0009/scd0009f.pdf">DiCon 2x2 prism switch</a>,
which is essentially a little piece of glass on a motor.</p>

<p><img src="https://raw.githubusercontent.com/CatherineH/CatherineH.github.io/master/_posts/images/dicon_switch.jpg" alt="A picture of a DiCon fiber optic switch" /></p>

<p>This switch will operate in several modes, but in every mode the first two (blue and purple) pins are used to set the
position and the second two (red and green) pins are used to read the position of the switch.</p>

<p>I chose to operate the switch in <em>Non-latching 2-pin Control</em> mode, because it was the least complicated.</p>

<p>I chose to put the two pins that should never change in control mode (purple should always be ground, red should always
be +5V) and the two pins with changing values (blue and green) on the other. This led to a lot of initial confusion, but
 I believe it was a good decision to because it allows me to keep the two pins that need to be hooked up to some external logic together.</p>

<p><img src="https://raw.githubusercontent.com/CatherineH/CatherineH.github.io/master/_posts/images/teensy_switch.jpg" alt="A picture of the headers going into the teensy" /></p>

<p>The threshold voltage for switching is above 3.3V, which is the maximum that the Teensy’s output pins can supply. Thus,
I chose to use a solid state relay to bump the signal up to 5V. I use Sharp Microelectronics
<a href="http://www.digikey.com/product-detail/en/sharp-microelectronics/PR22MA11NTZF/425-2602-5-ND/856883">R22MA1</a> because
they’re super cheap (25.65$ for 50) and I have a tendency to accidentally blow electronics up.</p>

<p>My prototype board looks like this:</p>

<p><img src="https://raw.githubusercontent.com/CatherineH/CatherineH.github.io/master/_posts/images/switch_bb.png" alt="Fritzing image of breadboard" /></p>

<p>Imagine the Sharp SSR on the breadboard instead of the Omron SSR. You’ll notice that I have left the green pin
unconnected. The switch has always activated when 5V, thus the position information isn’t useful right now.</p>

<h1 id="arduino-code">Arduino Code</h1>

<p>This teensy is also used to control several other pieces of experimental hardware, so I’ve excerpted it here.</p>

<p>I want to be able to read the current position state and write a new position state using a SCPI-compliant serial
connection.</p>

<p>My .ino code looks like this:</p>

<pre><code>#include "scpi_comm.h"
#include "optical_switch.h"
int switch_led_pin = 13;
int out_pin = 9;
settings _settings = {.switch_setting = 1, .motor = _state};

void setup()
{
  Serial.begin(9600);
  pinMode(switch_led_pin, OUTPUT);
  pinMode(out_pin, OUTPUT);
}

void loop()
{
  update_optical_switch(_settings.switch_setting, out_pin, switch_led_pin);
  if (Serial.available() &gt; 0) {
    comm_protocol(Serial.read(), &amp;_settings);
  }
}
</code></pre>

<p>My <em>scpi_comm.h</em> contains an internal state machine which collects characters into a string until the termination
character is received, then attempts to parse the string:</p>

<pre><code>typedef struct {
  int switch_setting;
} settings;

char terminationByte = '\r';
int incomingByte = 0;
int string_pos = 0;
int current_state = 1;
char line[15];
char serialsecond[5];
char input_str[8];
char output_str[8];

void comm_protocol(byte incomingByte, settings *settings){
   line[string_pos] = incomingByte;
   string_pos += 1;
   if(incomingByte == terminationByte)
   {
     if(strncmp(line, ":OUTP", 5)==0)
     {
         char * loc = strchr(line, ':');
          loc = strchr(loc+1, ' ');
          memcpy(serialsecond, loc+1, 3);
          if(strncmp(serialsecond, "1", 1) == 0)
          {
             settings-&gt;switch_setting = 1;
          }
          else
          {
            settings-&gt;switch_setting = 0;
          }
          sprintf(output_str, "Set Switch to %d%c", settings-&gt;switch_setting, terminationByte);
          Serial.write(output_str);
     }
     else if(strncmp(line, "OUTP", 4)==0 &amp;&amp; strpbrk(line, "?") != 0)
     {
         sprintf(output_str, "%d%c",  settings-&gt;switch_setting, terminationByte);
         Serial.write(output_str);
     }
     else{
        sprintf(output_str, "Unknown command%c", terminationByte);
        Serial.write(output_str);
     }
     // reset the string
     string_pos = 0;
     line[0] = '\0';
   }
}
</code></pre>

<p>Lastly, my <em>optical_switch.h</em> code simply reads the settings and makes the Teensy’s indicator LED also go high when the
switch position is high:</p>

<pre><code>void update_optical_switch(int optical_state, int switch_pin, int led_pin)
{
  if(optical_state==1)
  {
    digitalWrite(switch_pin, HIGH);
    digitalWrite(led_pin, HIGH);
  }
  else
  {
    digitalWrite(switch_pin, LOW);
    digitalWrite(led_pin, LOW);
  }
}
</code></pre>

<h1 id="python-computer-side">Python (Computer) Side</h1>

<p>I used the fantastic <a href="https://github.com/Galvant/InstrumentKit">InstrumentKit</a> to incorporate the control into my
experimental software:</p>

<pre><code>#!/usr/bin/env python
from instruments.abstract_instruments import Instrument
from time import sleep
from sys import platform

class Switch(Instrument):
    """
    An interface to the teensy-controlled optical switch
    """
    def __init__(self, filelike, increment=200):
        super(Switch, self).__init__(filelike)
        self.terminator = "\r"
        self.increment = increment

    @property
    def setting(self):
        """
        Get the current output setting
        :return: int, representing the currently active channel
        """
        response = self.query("OUTP?")
        return int(response)

    @setting.setter
    def setting(self, new_val):
        """
        Set the current output setting
        :param new_val: the output channel number, either 0 or 1
        :return:
        """
        if new_val == 0:
            response = self.query(":OUTP 0")
        elif new_val == 1:
            response = self.query(":OUTP 1")

def main():
   # Runs the switch program on its own, as a test
    if platform == "linux" or platform == "linux2":
        port = "/dev/ttyACM0"
    else:
        port = "COM11"
    switch = Switch.open_serial(port, 9600, timeout=1)
    print("switch tests")

    iteration = 0
    for i in range(0, 50):
        print("Iteration: "+str(iteration))
        iteration += 1
        switch.setting = 0
        sleep(2)
        switch.setting = 1
        sleep(2)

if __name__ == "__main__":
    main()
</code></pre>

<p>While the coding side of this application may seem a bit over-engineered, it is because I want to apply the
<a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment">principle of least astonishment</a> to everything I do; by
labeling everything I don’t have to guess at some convention I decided on several months ago. This switch is a simple
piece of a much more complex testing organism, and I want it to be the least complicated organ.</p>

    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/04/25/walking-through-frustration">Walking Through Mars and Frustration </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>25 April 2016</span>
    </div>
    <div class="content">
      
<p>Six months ago I participated in a hackathon for the City of Waterloo. I built a WebGL application that built a little model of Waterloo that you could tilt and zoom in a browser. I used the building footprint data to find the base of the models, then used the latest aerial laser scan data minus the elevation data to estimate the height of the buildings. I coloured the buildings based on what their reported purpose and size were - one color for commercial buildings, one for municipal buildings, and one for residential buildings, then within that sub-shades for the types of buildings - apartment buildings, duplexes, single family dwellings.</p>

<p>My desire to build this model came from my own curiosity - between the time that I moved to Waterloo in 2010 and left in 2015, an entire neighborhood transformed from 1950’s style bungalows to high-rise student housing, and I wanted to be able to see those buildings spring out of the ground. Also, I wanted an excuse to learn WebGL. The end result was a stylized version of google maps:</p>

<p><img src="https://pbs.twimg.com/media/CSMy-TbWoAAUefs.png:large" alt="ower screenshot" /></p>

<p>I was proud of what I’d put together in 48 hours, but it didn’t win anything. An app that for tracking trees won. It wasn’t technically impressive - Apple and Android both provide sample apps that allow you to add data to maps, and the tree data was provided by the city. City maintenance apps like this have been implemented by cities larger than Waterloo since 2010. But, the guys who won were funny teenagers, and it was impressive for their level of experience.</p>

<p>After that hackathon I came to a fairly obvious conclusion: hackathons are about showmanship rather than technical ability, but I would rather impress myself than impress a judge. I’ve won hackathons on the basis of good presentations, but they’re not the things I brag about later.</p>

<p>Last weekend was SpaceApps 2016 - a yearly coding challenge organized by NASA. Communities around the world organize events for SpaceApps, and in previous years I’d attended the ones in Kitchener-Waterloo and Toronto. There is no event - at least open to the public - in San Diego, so I signed up for the “everywhere” event. Knowing that there was no competition with a pitch at the end, I decided to go for the most technically challenging project I could find: procedurally generating game environments using web map tile service files of Mars.</p>

<p>The most obvious way to solve the challenge - even cited in the challenge description, was to build something in Minecraft, but I went with the Unreal Engine instead. My reasons were two-fold: modding Minecraft is so easy that it is taught to elementary-aged kids, and secondly: I don’t like Minecraft. I have plenty of creative outlets in my everyday life, so when I sit down to play a video game I want to indulge my destructive impulses. I’d prefer to play first person shooters, hence my interest in building something in the Unreal Engine.</p>

<h1 id="getting-the-data">Getting the data</h1>
<p>NASA is gradually improving their data services. My first encounter with them was in high school, where for a science fair project I downloaded their database of asteroid impact crafters to correlate the size and age using deeply flawed statistics to validate a hypothesis about Jupiter being the solar system’s asteroid dust-buster. Back then, I had to use ftp and some text macros to extract the desired data. It was painful.</p>

<p>These days they’re moving to web-based APIs, but it’s still not as good as it could be. They claim that their datasets are WTMS-compliant, but I could not get a python WTMS library working with any of the datasets I wanted. I had two possible options - use the HiRISE data, which involves downloading large binary files via FTP, and then writing my own scripts to parse the binary data to a format I could use just as I had in high school, or going through the NASA  API to pull down much lower-resolution data sets and pulling them down one image at a time. This being a hackathon, I went with the second option.</p>

<p>I used the Mars Orbital Laser Altimeter to get grayscale png images for elevation, then pulled down the images from the Viking missions for colors and texture information. The highest resolution for both datasets were different, so I had to stitch together images, but thanks to the urllib and pillow python libraries, this was trivially easy.</p>

<p>Unreal Editor can turn grayscale images into level landscapes, and then generate the textures from images. Within four hours of starting my git repo, I had this:</p>

<p><img src="https://pbs.twimg.com/media/CgvhX-3UcAAzd38.jpg:large" alt="false hope screenshot" /></p>

<p>Great! Challenge solved, time to hand in my solution and spend the rest of the weekend playing Borderlands. I just needed to programmatically spawn the process to generate landscapes and since Unreal Engine and Editor is open-source, I thought it couldn’t be that hard.</p>

<p>Spoiler Alert: I was <em>super</em> wrong.</p>

<h1 id="failure-1-automating-landscape-generation">Failure 1: Automating Landscape Generation</h1>

<p>The problem is that landscapes are built into the level on build, and are impossible to change at run time. I’m trying to think of any FPS that have terrain that changes while you’re playing through a level or environment, and I can’t really think of any. Unlike top-down RPGs like Diablo, FPS’s rely on a lot of physics and not falling through things that are much harder to guarantee with a procedurally-generated world. Also, the load times on new levels are much faster if you have a pre-baked, compressed description of the landscape.</p>

<p>At this point I considered giving up, but I kept going because the solution was so tantalizingly close: I could extract the compressed files that contained the landscape information, and somewhere in the source code for the Unreal Editor was the functionality to generate these files.</p>

<p>After three hours of poking through the Unreal Editor in Visual Studio with IntelliSense (I don’t recommend this, Visual Studio crashed five times during this time), I identified the sections that did the importing and then writing to a file. I attempted to pull them out and build a standalone C++ application that could convert grayscale images to Unreal Editor map files.</p>

<p>However, this code wasn’t intended to operate on its own. As time went on, I was pulling in more and more of the unreal editor - first the menus for generating landscapes, then the new level editor, then the editor gui itself. Basically, I was re-implementing the Unreal Editor with no end in sight.</p>

<p>At this point, 13 hours in, I considered giving up again. I was tired of Visual Studio crashing, and feeling cheated out of what I thought was a simple operation. But John sent me a tutorial on procedurally generating meshes at runtime and I had a crazy idea - why don’t I just delete the landscape and use a spawned mesh object instead?</p>

<h1 id="success-1-generating-meshes">Success 1: Generating Meshes</h1>

<p>For reasons my sleep-deprived post-hackathon brain can’t remember, the mesh tutorial code didn’t work with Unreal Engine 4.11, but did with 4.7. So, after spending an hour removing 4.11/Visual Studio 2015 and installing 4.7/Visual Studio 2013, I was back in business.</p>

<p>I intended that my Unreal Engine mesh generator code would check the tile cache for the desired section of Mars to render, and if it didn’t exist, execute the python script for pulling down the missing tiles. I encountered a problem implementing this: the windows C SDK does not play nicely with the Unreal Engine API. This is for good reason - Unreal Engine wants to be cross-platform, so they have re-implemented all the standard functionality of C independent of each operating system. If you attempt to include both the Unreal Engine and the Windows SDK in the same application, Visual Studio will bug out because it’s not sure which version of <em>int</em> you want to use.</p>

<p>I scrapped that idea. Luckily, reading and writing files isn’t the only way to get data into the Unreal Engine at runtime because networking is required for multiplayer games. After another four hours, I had a python server communicating with my Unreal Engine application. My first ground meshes looked like this:</p>

<p><img src="https://pbs.twimg.com/media/Cg08v0AU8AAymmo.jpg:large" alt="mesh screenshot" /></p>

<p>It’s off the ground because I hadn’t sorted out the math yet, and it suddenly turns into a giant vertical wall because it turns out a TCP packet is not large enough to store the raw data required to render a 400 km-across section of Mars. So, I wrote the first compression method I could think of, and was able to serve mars up 3 Kbytes at a time. The result looked like this:</p>

<p><img src="https://pbs.twimg.com/media/Cg1TEqbUYAAk8Vr.jpg:large" alt="final mesh screenshot" /></p>

<p>That red planet sure is… red.</p>

<h1 id="failure-2-colouring-the-ground">Failure 2: Colouring the ground</h1>

<p>Like landscape files, textures are compressed and baked into the levels prior to runtime. No problem, I’d solve that issue like I had with the meshes: change the color of the triangles in the mesh to match the corresponding pixel in the images.</p>

<p>I had all of this implemented two hours before the deadline, but then shit started crashing. I was hitting a breakpoint in the memory allocation functionality of Unreal Engine. In addition, color images aren’t as smooth as surface data, so my poorly-implemented compression method wasn’t cutting it anymore. I would guess that these two issues are related. At this point, frustrated and exhausted, I decided to pack up and submit what I had.</p>

<h1 id="conclusion">Conclusion</h1>

<p>So that was it. In the end, I tracked 29 hours working on SpaceApps this year, compared to 15 hours in 2015, and this year was way more stick-your-head-through-your-keyboard inducing than last year.</p>

<p>For reference, this is what John and I together were able to create at the end of SpaceApps 2015:</p>

<p><img src="https://pbs.twimg.com/media/CCZY3zHUAAAOsVm.png:large" alt="DBNN.NASA screenshot" /></p>

<p>That project was much less frustrating than this one because it involved 
machine-learning analysis of experimental data in python, which is pretty 
much what John and I do for work. All of the code was built on existing tools
 used by scientists, who, despite what people may think, maintain their code 
 better than video game developers. Game developers are under constant pressure to release the next big game and thus don’t have much time or incentive to contribute back to the community, whereas (good) scientists’ reputation depends on other people being able to use the frameworks they create.</p>

<p>Throughout this challenge, I was often attempting to use things in ways 
they weren’t meant to be used: using meshes as landscapes the player could walk on, using the networking protocol to serve massive texture data instead of the locations of other players.</p>

<p>Since my project crashed with two hours left on the clock, I wasn’t able to make a video of what it looks like to walk around in my generated Mars. This means the project likely won’t win anything. That’s fine: like with the Waterloo hackathon, impressing myself was more important than impressing a judge, and in that goal I succeeded. Not because of what I learned: though I learned a lot about how the unity engine and editor work, the real takeaway was that I really don’t want to be a AAA game developer if these are the tools they have to use. I’m impressed with myself because several times this weekend in the face of a problem - like automating the landscape generation - I was miserable and had decided to quit. But every time I did, I would go nap on the couch for a bit, wake up, and go right back to banging my head through the keyboard.</p>

    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/physics/2016/04/19/gendered-electrons-and-hiding-under-tables">Gendered Electrons and Hiding Under Tables </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>19 April 2016</span>
    </div>
    <div class="content">
      
<p>In high school I was the one girl in a group of seven students who would hang out at the town ‘science center’ after school twice a week. ‘Science Center’ is in quotes because it was the disorganized office of a retired experimental physicist with some no-budget-physics demonstrations. I often left the ‘science center’ more confused than educated, but I loved physics so I stubbornly kept attending.</p>

<p>The primary factor in my confusion was that the experiments were not well 
explained, but there were other contributing factors. Maybe it was the 
learning style: as a teenager I would read undergrad-level physics textbooks,
 daydream about how to turn what I’d learned into an episode
  of <em>Star Trek</em>, and then struggle with the end chapter problems, and this
   worked better than a lecture and a demonstration. Maybe it was the 
   non-physics content: more time was spent arguing over politics and 
   religion than learning about physics, and I, a liberal atheist in a 
   town referred to as the ‘little vatican’ and in the riding of Peter MacKay, was always wrong. Or maybe it was the weird analogies: electrons were boys, protons were girls, because boys have no mass and can’t stand to be in the same state together? <em>No homo</em>.</p>

<p>The men running the science center had the best of intentions, but they were quirky. The retired physicist was devoted to an obscure interpretation of quantum mechanics that had its last death throes in the early nineties. Explanations subtly included this interpretation, which didn’t mesh with the things I was reading. There were religious (Catholic) and cultish undertones: he insinuated that if I studied physics I would realize the importance of all life and never get an abortion. Studying physics at school was ‘mickey mouse’ compared to the education I was promised at the science center.</p>

<p>And they were unnecessarily critical. One afternoon I gave a summary of a textbook on cosmology I’d recently read. I was so excited about how the heavier elements fused together in the sun that my mouth went faster than my brain and I repeatedly said carbon monoxide instead of carbon dioxide. One of the men running the science center picked up on this, and interrupted to correct me using the socratic method. The socratic method is a fantastic way to introduce new students to knowledge just outside their understanding, but if you do this to a 16 year old girl who has 98-99% grades in her high school chemistry classes and surely knows the difference between carbon dioxide and monoxide, it is extremely condescending.</p>

<p>My reaction was not, <em>Oh right, carbon dioxide, whatever</em> but rather to think 
<em>he thinks I’m dumb and it’s true what am I doing here</em> and then hide under 
the table to cry. This memory is not a metaphor for how I felt at the time: 
<em>I actually hid under the table and cried</em>.</p>

<p>The boys in the group tried to cheer me up by saying things like “more men are geniuses but women are smarter on average”, and “you may not be good at math but you’re really good at explaining things”, the implication being: you’re not special like us but you’re still smarter than most people we know. It didn’t make me feel any much better.</p>

<p>I wish I could say that these experiences made me stronger, but there’s no 
evidence they did. I had many more hiding-under-the-table incidents in 
undergrad, through graduate school, and in my post-school career, and will 
probably continue reacting to things this way because I am a coward who would 
rather read physics papers alone and not have to prove I’m smart to anyone.</p>

<p>But over a decade on, only one of those seven students ended up in a career in physics.</p>

<p>It was me.</p>


    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/04/15/arduino-builder-errors">arduino builder errors </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>15 April 2016</span>
    </div>
    <div class="content">
      
<p>My life revolves around three boards: the digi rabbit, an altera FPGA, and a
teensy (an arduino-compatible microcontroller).</p>

<p>The provided IDE’s for each of these boards <strong>suck</strong>, but teensy’s <strong>sucks the
least</strong>. They are ugly and they get in the way of my productivity. Since the code to interface with the boards 
written in python I’ve been migrating my digi rabbit and altera
development to PyCharm. This post documents the errors encountered moving from the arduino IDE to the arduino-builder.</p>

<h1 id="index-out-of-range-on-board-resolver"><code>index out of range</code> on Board Resolver</h1>

<p>A <a href="https://github.com/arduino/arduino-builder/pull/141">merged pull request on arduino-builder</a> should prevent this error from occuring in future.</p>

<p>The arduino-builder requires the full board name to be specified as
 something like package_name:platform_name:board_name . The colons are
 essential and the arduino-builder will not check to make sure the full board
  name follows this pattern. If you don’t specify the board in that form, you
   will get the error:</p>

<pre><code>$ arduino-builder -fqbn teensyLC -hardware ~/arduino-1.6.7/hardware/ -tools ~/arduino-1.6.7/tools experiment_control.ino
panic: runtime error: index out of range

goroutine 1 [running]:
arduino.cc/builder.(*TargetBoardResolver).Run(0x6c3050, 0xc20803c4e0, 0x0, 0x0)
	~/arduino-builder/src/arduino.cc/builder/target_board_resolver.go:46 +0xf44
arduino.cc/builder.(*ContainerSetupHardwareToolsLibsSketchAndProps).Run(0x6c3050, 0xc20803c4e0, 0x0, 0x0)
	~/arduino-builder/src/arduino.cc/builder/container_setup.go:59 +0x6b8
arduino.cc/builder.runCommands(0xc20803c4e0, 0xc20802db90, 0x1d, 0x1d, 0x418001, 0x0, 0x0)
	~/arduino-builder/src/arduino.cc/builder/builder.go:187 +0x139
arduino.cc/builder.(*Builder).Run(0xc20802dd88, 0xc20803c4e0, 0x0, 0x0)
	~/arduino-builder/src/arduino.cc/builder/builder.go:118 +0xef7
arduino.cc/builder.RunBuilder(0xc20803c4e0, 0x0, 0x0)
	~/arduino-builder/src/arduino.cc/builder/builder.go:218 +0x49
main.main()
	~/arduino-builder/main.go:333 +0x1eb2

</code></pre>

<h2 id="resolution">Resolution</h2>

<p>Change the <em>-fqbn</em> parameter to the <em>package_name:platform_name:board_name</em>
format. You can guess what this needs to be by looking at the arduino folder
structure. For example, my folder structure has:</p>

<pre><code>arduino-1.6.7
└── hardware
    ├── arduino
    └── teensy
        └── avr
            └── boards.txt

</code></pre>

<p>The <em>boards.txt</em> specifies the available boards for that platform. Opening up
 the file, I can see teensy30, teensy31, and so on. If I change the board
 name to <strong>teensy:avr:teensyLC</strong>, the error no longer occurs. Note that this
 string is case sensitive!</p>

<h1 id="not-finding-the-arm-compiler">Not finding the arm compiler</h1>

<p>You may get the error:</p>

<pre><code>fork/exec /../arm/bin/arm-none-eabi-g++: no such file or directory
</code></pre>

<h2 id="resolution-1">Resolution</h2>

<p>Set the <strong>-tools</strong> argument to:</p>

<pre><code> -tools ~/arduino-1.6.7/hardware/tools/
</code></pre>

<h1 id="missing-build-variables">Missing build variables</h1>

<p>Because we’re no longer in the arduino IDE, a bunch of menu-specified 
variables won’t be set. This will result in errors like:</p>

<pre><code>&lt;command-line&gt;:0:1: error: macro names must be identifiers
In file included from ~/arduino-1.6.7/hardware/teensy/avr/cores/teensy3/core_pins.h:34:0,
                 from ~/arduino-1.6.7/hardware/teensy/avr/cores/teensy3/wiring.h:33,
                 from ~/arduino-1.6.7/hardware/teensy/avr/cores/teensy3/WProgram.h:15,
                 from ~/arduino-1.6.7/hardware/teensy/avr/cores/teensy3/Arduino.h:1,
                 from /tmp/arduino-sketch-55293F9A6EDF8EF849C232A18F1833A8/sketch/experiment_control.ino.cpp:1:
~/arduino-1.6.7/hardware/teensy/avr/cores/teensy3/kinetis.h:568:12: error: operator '==' has no left operand
 #if (F_CPU == 180000000)
            ^
</code></pre>
<p>or, alternatively, you may see something like these errors:</p>

<pre><code>arm-none-eabi-g++: error: {build.flags.optimize}: No such file or directory
</code></pre>

<h2 id="resolution-2">Resolution</h2>

<p>This is a hack (<em>build systems people avert your eyes</em>), but I’ve added:</p>

<pre><code>teensyLC.build.fcpu=48000000
teensyLC.build.flags.optimize=-Os
teensyLC.build.flags.ldspecs=--specs=nano.specs
teensyLC.build.keylayout=US_ENGLISH
teensyLC.build.usbtype=USB_SERIAL
</code></pre>

<p>to my <strong>boards.txt</strong> file.</p>

<h1 id="ctags-file-does-not-exist">Ctags file does not exist</h1>

<p>The following error may occur when compiling for arduino-branded (i.e., uno, mega, etc) boards:</p>

<pre><code>exec: "{runtime.tools.ctags.path}/ctags": file does not exist
</code></pre>

<h2 id="resolution-3">Resolution</h2>

<p>When executing arduino-builder, add the argument:</p>

<pre><code>-tools ~/arduino-1.6.7/tools-builder
</code></pre>

    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/04/13/mocking-entire-modules">Mocking Entire Modules </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>13 April 2016</span>
    </div>
    <div class="content">
      
<p>I’m increasing the code coverage on my <a href="https://github.com/CatherineH/pyglet_helper">pyglet_helper</a>
project prior to adding new functionality.
As of right now it is:</p>

<p><a href="https://coveralls.io/github/CatherineH/pyglet_helper?branch=master"><img src="https://coveralls.io/repos/github/CatherineH/pyglet_helper/badge.svg?branch=master" alt="Coverage Status" /></a></p>

<p>If this is green, I have succeeded in my task. Go me!</p>

<p>Before I got this spiffy number, I had to tackle an issue: pyglet_helper project is built on top of OpenGL, but OpenGL needs a display to draw to. The continuous integration system I am using (Travis) does not
have a display.</p>

<p>After embarking on a fool’s errand to get <a href="http://xpra
.org/trac/wiki/Xdummy">Xdummy</a> working in a docker container, my friend <a href="http://scasagrande.github.io/">Steven</a> pointed to an easier solution: simply create
 a fakeGL module and then run the tests using that instead of OpenGL. This
 is not an ideal solution, as my unit tests will only check to make sure
 that the math is correct, and not that things are being drawn to the screen
  without glitching, but at the moment I’m okay with that. I’m not trying to
   test the functionality of OpenGL; I want to test that my math and the
   inheritance of the objects in pyglet_helper works out. My own math
   mistakes, and not OpenGL, are responsible for 99% of the weird visual
   glitches in pyglet_helper.</p>

<p>This post details how to replace an entire module in python unit tests,
since I didn’t find it in my initial reading of the mock documentation.</p>

<p>As an example, suppose we have some math to be tested on a 
Windows AMD machine<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>. Thus, we would like to mock out numpy.</p>

<p>The function to be tested is in the file <strong>one_deep.py</strong>:</p>

<pre><code>import numpy

def sum_array(lower, upper):
    return sum(numpy.arange(lower, upper))
</code></pre>

<p>This module uses the arange function in numpy, so the file <strong>fake_numpy.py</strong>
 contains the code:</p>

<pre><code>def arange(lower, upper):
    return range(lower, upper)
</code></pre>

<p>Essentially, the range is now a list instead of a numpy array.</p>

<p>The unit test, which replaces <strong>numpy</strong> with <strong>fake_numpy</strong> is:</p>

<pre><code>from mock import patch
import fake_numpy


@patch('one_deep.numpy', new=fake_numpy)
def test_sum_to_hundred():
    from one_deep import sum_array
    result = sum_array(4, 16)
    assert result == 114
</code></pre>

<p>Now, suppose we need to go deeper. A second function is in the file
<strong>two_deep.py</strong>:</p>

<pre><code>from one_deep import sum_array
import numpy


def sum_array_again(lower, upper):
    return sum(numpy.arange(lower, sum_array(lower, upper)))
</code></pre>

<p>In our unit tests, if only <strong>two_deep</strong> is patched, when <strong>sum_array</strong> is
called, it will still use <strong>numpy.arange</strong> instead of <strong>fake_numpy.arange</strong>.
 This can produce some interesting errors if <strong>numpy</strong> is expecting to
 operate on <strong>numpy</strong> types.</p>

<p>Thus, the module must be patched all the way down:</p>

<pre><code>from mock import patch
import fake_numpy


@patch('one_deep.numpy', new=fake_numpy)
@patch('two_deep.numpy', new=fake_numpy)
def test_sum_to_hundred():
    from two_deep import sum_array_again
    result = sum_array_again(4, 16)
    assert result == 6435
</code></pre>

<p>Unfortunately, I haven’t figured out a good way of making sure that numpy
gets patched all in every place where it is invoked yet, leading to a lot of
 failed Travis builds as I encover another layer of a pyglet_helper object’s
  dependencies which rely on OpenGL.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Numpy does not support Windows running on AMD chips, as I recently learned. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/music/2016/04/11/vikings-in-hungary">Vikings in Hungary </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>11 April 2016</span>
    </div>
    <div class="content">
      
<p>Six months ago, one of my co-workers (Matthew from Clearpath) enlightened
me to the existence of Viking metal. Since then I’d watched the occasional
viking metal youtube video for the lols, but was not further tempted.
However, a few weeks ago I went to an <strong>Abbath</strong> concert and the <strong>Bathory</strong>
logo had almost as much real estate on patches and T-shirts as <strong>Immortal</strong>,
so I
caved and listened to their entire discography. These are my thoughts on Bathory.</p>

<p>Bathory<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>’s discography can be split into four categories: the extreme
metal 80s, proto-Viking metal early 90s, generic thrash metal in the mid 90s, and
Quorthon’s (the lead singer) one man viking concept albums of the early 00s.
Of these periods, the extreme metal and the generic thrash metal albums
are totally skipable. The thrash metal albums were dated when they came
out; <strong>Pantera</strong> had already done it better. The lyrics from one song in this
period merely list political or religious ideologies ending with the y-sound.</p>

<p>I don’t like their extreme metal phase because of the lo-fi recording and
the drumming that is played too fast to land the hits on target. I’m mildly
anxious about calling their first 4 albums skipable, because the technical
things I don’t like are probably part of the attraction for fans of 80’s death metal.</p>

<p>The proto-Viking metal albums are what the band are most known for, and they
are worth a listen. The epic lyrics, the folk-style singing, and the
acoustic guitars all make for a (mostly) pleasant listening experience.
However, the albums are flawed. Quorthon was not a strong singer and often
ventures out of his range. The ballads are a little boring, and the songs
are often too verbose to let the melodies breath. The song <em>Hammerheart</em>
from <em>Twilight of the Gods</em> is a particularly egregious example. It’s a
‘‘cover’’ of Holst’s Jupiter with mismatched lyrics sung out of key. I don’t think I’ll be going back to these albums.</p>

<p>In the early 00s, Quorthon produced three albums alone under the Bathory
name. The first, <em>Destroyer of Worlds</em>, is an interesting mix of contemporary
influences. Some songs have guitar licks reminiscent of <strong>Frusciante</strong>, another
song sounds a lot like stoner metal. There’s a male rage-type thrash metal
song that would have fit right in on <em>Reinventing the Steel</em>, and Quorthon’s
rough vocals lend it an authenticity that make it a lot more tolerable than
Pantera. Although I like this album, there are a few obvious flaws, the
largest being that Quorthon needed to step away from the sound effect
machine<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup>. I wasn’t expecting a hockey arena organ in metal.</p>

<p>Quorthon’s next two albums, <em>Nordland I</em> and <em>II</em>, revisit viking metal and are
better this time around: the lyrics mesh with the rhythm, the melodies have
space to shine, and the ballads don’t get boring. Quorthon even makes
synthetic horns pleasant, which I thought was impossible. My favourite
Bathory song, <em>Vinterbolt</em>, is off of <em>Nordland I</em>:</p>

<p><a href="https://www
.youtube
.com/watch?v=4B1YDPE20Ss"><img src="http://img.youtube.com/vi/4B1YDPE20Ss/0.jpg" alt="Vinterland Link" /></a></p>

<p>In my opinion, Bathory, along with <strong>Gentle Giant</strong> and <strong>Van der Graaf
Generator</strong>, are examples of bands who didn’t quite have the technical chops
or creativity to perfect their pioneering ideas. Viking metal was a novel style
in the early 90s, but unfortunately a twenty year back catalog clouded my
first listen of Hammerheart.</p>

<p>Of the four styles in the Bathory discography, the Quorthon solo-albums at
the end of his career hold up the best against the test of time. He was
experimenting with the latest sounds at the time across multiple genres, and
seemed to be trying to fix issues from record to record. Quorthon planned
another two albums to his Nordland series but died young before they were completed, and that is a shame. He was just getting good.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Countess Bathory is to Metal and Gothic Fantasy RPGs as Ada Lovelace is to computing: they are very interesting women who are not commonly known to the general public, but their story has been retold ad nauseum. Bathory’s song about Countess Bathory is one of the better exemplars, but surely the genres can find other lady serial killers to idolize. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Panzer Division Marduk used the same World War 2 bombing sound two years earlier; Quorthon should have known better. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/03/31/libraries-in-dynamic-c">Libraries in Dynamic C </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>31 March 2016</span>
    </div>
    <div class="content">
      
<p>2000+ line <strong>main</strong> functions are no fun, but Dynamic C does not make
modularization easy. In this post, I’ll document all of the details of using
library functions and the problems I’ve encountered using them.</p>

<h1 id="linking-libraries">Linking Libraries</h1>

<p>The Dynamic C compiler will look for libraries in the directory structure
detailed in the file <strong>C:\DCRABBIT_XX\LIB.DIR</strong>. After a default
installation, this file will point towards <strong>C:\DCRABBIT_XX\LIB</strong> and certain
 <strong>SAMPLES</strong> directories. Since <strong>C:\DCRABBIT_XX</strong> is read-only, I prefer to
 create a link between the location of my source and the
 <strong>C:\DCRABBIT_XX\LIB</strong> directory, rather than either copying the files to
 this directory or editing the <strong>LIB.DIR</strong>. On Windows, this can be done using:</p>

<pre><code>mklink C:\DCRabbit_9.62\Lib\starship.lib
C:\Users\catherine\Rabbit3400\lib\starship.lib
</code></pre>

<p>This needs to be done as administrator, which can either be done by running
the command prompt as administrator, or by using runas:</p>

<pre><code>runas /noprofile /user:pink-beast-windows\catherine "mklink C:\DCRabbit_9
.62\Lib\starship.lib C:\Users\catherine\Rabbit3400\lib\starship.lib"
</code></pre>

<p>However, this results in the error:</p>

<pre><code>The system cannot find the file specified.
</code></pre>
<p>and my windows-file-system-fu is not strong enough to figure out what I’m
doing wrong. Maybe when ubuntu comes to windows 10 I’ll be able to ignore my
ignorance.</p>

<h1 id="a-sample-library">A Sample Library</h1>

<p>The following is an example project in Dynamic C with two libraries. The
first library is called <em>starship.lib</em> and contains the source:</p>

<pre><code>/*** BeginHeader StarshipCrew */
struct StarshipCrew{
    char captain[10];
    char first_officer[10];
    char chief_engineer[10];
    char chief_medical_officer[10];
};
/*** EndHeader */
</code></pre>
<p>The second library is called <em>starship_functions.lib</em> and contains the source:</p>

<pre><code>/*** BeginHeader assignCaptain */
void assignCaptain(struct StarshipCrew * starship, char * captain);
/*** EndHeader */
void assignCaptain(struct StarshipCrew * starship, char * captain)
{
    sprintf(starship-&gt;captain, "%s", captain);
}
</code></pre>
<p>And main looks like this:</p>

<pre><code>#use "starship.lib"
#use "starship_functions.lib"

main(){
    struct StarshipCrew enterprise;
    char captain[10];
    sprintf(captain, "Picard");
    assignCaptain(&amp;enterprise, captain);
    printf("Captain of the Enterprise is %s\n", enterprise.captain);
}
</code></pre>
<p>This program compiles correctly once the links to the libraries are created
in the library directory.</p>

<h1 id="troubleshooting">Troubleshooting</h1>

<p>Although I’ve just shown you works, there are many, many ways that libraries
can be broken, and the compiler messages are not terribly useful.</p>

<h2 id="use-statements-do-not-chain">#use statements do not chain</h2>

<p>If you move the <em>#use “starship.lib”</em> line to the <em>starship_functions.lib</em>,
the main won’t be able to find the struct definition. The compiler will
report the error:</p>

<pre><code>line    5 : ERROR a_starship_test.c   : Struct use before definition.
line    9 : ERROR a_starship_test.c   : ) is missing/expected.
line    9 : ERROR a_starship_test.c   : Invalid struct reference.
</code></pre>

<p><strong>Solution</strong></p>

<p>Keep all use statements in your main() file.</p>

<h2 id="missing-beginheader-statements">Missing BeginHeader statements</h2>

<p>Although they look superfluous, the <em>BeginHeader</em> statements are essential.
Without the BeginHeader statement on the struct, this will create the error:</p>

<pre><code>line    4 : ERROR a_starship_test.c   : Struct use before definition.
line    8 : ERROR a_starship_test.c   : ) is missing/expected.
line    8 : ERROR a_starship_test.c   : Invalid struct reference.
</code></pre>

<p>Without the BeginHeader statement on the function, the error is:</p>

<pre><code>line    7 : WARNING a_starship_test.c   : Reference to 'assignCaptain' has no corresponding prototype.
line    7 : ERROR a_starship_test.c   : Undefined (but used) global label assignCaptain
</code></pre>

<p>It is important that the function name matches the function. For example, if
the <em>BeginHeader</em> statement is changed to:</p>

<pre><code>/*** BeginHeader assignCap */
void assignCaptain(struct StarshipCrew * starship, char * captain);
/*** EndHeader */
</code></pre>
<p>Then the compiler error is:</p>

<pre><code>line    2 : ERROR STARSHIP_FUNCTIONS.LIB   : Undefined (but used) global label assignCaptain
</code></pre>

<p><strong>Solution</strong></p>

<p>All structs, typedefs and functions need <em>BeginHeader functionName</em> statement
 around the prototype, and <em>functionName</em> must match the struct or function
 name.</p>

<h2 id="cleaning-out-compiled-libraries">Cleaning out compiled libraries</h2>

<p>When a program with the <em>#use</em> statement is compiled, the compiler will look
for the compiled library files for the used library. These are the files with
 the extension <em>HX1</em> and <em>MD1</em>. If it can’t find these files, it will first
 compile the library, if it does find the files, it will ignore the <em>lib</em>
 file. This means that if you fix an error in your <em>lib</em> file, the next time
 you compile your project, you will get the <em>super helpful</em> error of:</p>

<pre><code>line    2 : ERROR STARSHIP_FUNCTIONS.LIB   : Need function definition or declaration.
line    2 : ERROR STARSHIP_FUNCTIONS.LIB   : Syntax error - or garbage at end of program.
</code></pre>

<p><strong>Solution</strong></p>

<p>Before compiling your program, delete the HX1 and MD1 files for each library
changed.</p>

<h2 id="order-of-import-errors">Order of Import Errors</h2>

<p>I’m not sure exactly how to replicate this error, but I have occasionally
encountered compiler errors like this:</p>

<pre><code>line  333 : ERROR LCD_FUNCTIONS.LIB   : Redefinition of parameter 1 different.
</code></pre>

<p>I’m not sure what causes this, but it typically happens when a library
function uses a struct defined in another library, and this library is
imported before the library with the function is imported in the <em>main()</em>
function.</p>

<p><strong>Solution</strong></p>

<p>I’ve fixed this error by switching the order of imports from:</p>

<pre><code>#use "lcd_functions.lib"
#use "library_with_struct.lib"
</code></pre>

<p>to:</p>

<pre><code>#use "library_with_struct.lib"
#use "lcd_functions.lib"
</code></pre>


    </div>

  </div>
</div>

<div class="page-header">
  <h1><a class="post-link" href="/programming/2016/03/30/no-malloc-no-problem">No malloc, No problem </a></h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>30 March 2016</span>
    </div>
    <div class="content">
      
<p>Although AVR now dominates the microcontroller landscape, some hardware
projects still rely on older chips with quirky, proprietary versions of C.
When working with these chips, many of C standard library functions are
either unavailable or implemented… <em>creatively</em>. In this case: how to use
arrays of strings in <a href="http://www.digi.com/support/productdetail?pid=4978">Digi’s Dynamic C</a>.</p>

<p>Dynamic C has no <em>malloc</em> function. Instead, memory is allocated by declaring
variables, such as:</p>

<pre><code>char my_string[8];
</code></pre>

<p>All variables must be declared at the start of functions. For example, the
perfectly valid C99 code:</p>

<pre><code>main(){
    int a;
    a = 5;
    int b;
    b = a;
    printf("b is: %d", b);
}
</code></pre>

<p>Results in the error:</p>

<pre><code>line    4 : ERROR a_test.c     : int is out of scope/ not declared.
line    4 : ERROR a_test.c     : b is out of scope/ not declared.
</code></pre>

<p>The working code for Dynamic C is:</p>

<pre><code>main(){
    int a;
    int b;
    a = 5;
    b = a;
    printf("b is: %d", b);
}
</code></pre>

<p>This is frustrating, but not totally unworkable. Now let’s move on to something
more complicated. Suppose you want an array of strings. Thanks to <a href="http://stackoverflow.com/a/17466642/1437859">this
StackOverflow answer</a> we know
that this code will work in C99:</p>

<pre><code>main(){
    char * point_names[5];
    int i;
    for(i=0;i&lt;5;i++) {
        point_names[i] = malloc(100);
        sprintf(point_names[i], "number %d", i);
    }
    for(i=0;i&lt;5;i++){
        puts(point_names[i]);
    }
}
</code></pre>
<p>Note that without the malloc() statement, the program will seg fault. In
Dynamic C, the program won’t seg fault, but it will print out gibberish.
Since malloc() does not exist in Dynamic C, we’ll have to
declare a variable with the size we want, put the data there, and then copy
the pointer to our array of pointers:</p>

<pre><code>main(){
    char names[5][100];
    char * point_names[5];
    int i;
    for(i=0;i&lt;5;i++) {
        sprintf(names[i], "number %d", i);
        point_names[i] = names[i];
    }
    for(i=0;i&lt;5;i++){
        puts(point_names[i]);
    }
}
</code></pre>
<p>If point_names is declared right after names, then sprintf’ing right to
point_names will work. This is getting into risky territory, however.</p>


    </div>

  </div>
</div>

      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2016 Catherine Holloway
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
        </p>
      </div>
    </div>

    





    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

