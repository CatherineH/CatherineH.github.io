
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Troubleshooting Windows dll imports in Python</title>
    <meta name="description" content="Some obvious stuff for next time">
    <meta name="author" content="Catherine Holloway">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="http://CatherineH.github.io/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="http://CatherineH.github.io/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Catherine's Auxiliary Brain</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/categories">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/pages">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/tags">Tags</a></li>
      	
      
    
  



          </ul>
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>Troubleshooting Windows dll imports in Python </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>07 July 2016</span>
    </div>
    <div class="content">
      
<p>I stumbled over some fairly obvious things when importing a Windows dll in python this
 morning. Iâ€™m writing this post to shorten the amount of time I spend reading Stack
 Overflow next time.</p>

<p>The code I will be using for this post is:</p>

<pre><code>from ctypes import cdll
lib = cdll.LoadLibrary("mydll.dll")
</code></pre>

<h1 id="are-you-using-the-static-version-of-the-library-instead-of-the-dynamic-version">Are you using the static version of the library instead of the dynamic version?</h1>

<p>ctypes can only import dynamic libraries. If you attempt to load a static library, you
 will get the error:</p>

<pre><code>  File "Python35\Lib\ctypes\__init__.py", line 425, in LoadLibrary
    return self._dlltype(name)
  File "Python35\Lib\ctypes\__init__.py", line 347, in __init__
    self._handle = _dlopen(self._name, mode)
OSError: [WinError 193] %1 is not a valid Win32 application
</code></pre>

<p>Make sure the dynamic <em>.dll</em> file is loaded, not the static <em>.lib</em> file. If only
static libraries are provided, it might be possible to recompile as a dynamic library,
but I did not try this.</p>

<h1 id="are-you-using-32-bit-python-with-a-64-bit-library">Are you using 32 bit python with a 64 bit library?</h1>

<p>Using a 64-bit dll with 32 bit python results in the error:</p>

<pre><code>   File "Python35\lib\ctypes\__init__.py", line 429, in LoadLibrary
    return self._dlltype(name)
  File "Python35\lib\ctypes\__init__.py", line 351, in __init__
    self._handle = _dlopen(self._name, mode)
OSError: [WinError 193] %1 is not a valid Win32 application
</code></pre>

<p>To solve this, download the <a href="https://www.python.org/downloads">Windows x86-64</a> version
 of python, and configure your IDE to use this python interpreter.</p>

<h1 id="are-you-using-the-32-bit-version-of-ctypes-with-a-64-bit-version-of-python">Are you using the 32 bit version of ctypes with a 64 bit version of python?</h1>

<p>If you install the 64 bit version of python alongside the 32 bit version, it is likely
 that your environment variables will still be set up to point the PYTHONPATH to the
 32 bit versions of the python libraries.</p>

<p>This will result in the error:</p>

<pre><code>   File "example.py", line 1, in &lt;module&gt;
    from ctypes import cdll
  File "Python35\lib\ctypes\__init__.py", line 7, in &lt;module&gt;
    from _ctypes import Union, Structure, Array
ImportError: DLL load failed: %1 is not a valid Win32 application.
</code></pre>

<p>To fix this, I set the PYTHONPATH in my IDE to be <em>Python35\Lib\;Python35\libs;
Python35\DLLs</em></p>

<p>On Windows, with python &gt; 3.5, it is important to add the DLL folder; the <em>_ctypes</em>
module lives in there now.</p>


    </div>

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-open"></i></li>
      
      


  
     
    	<li><a href="http://CatherineH.github.io/categories.html#programming-ref">
    		programming <span>9</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="http://CatherineH.github.io/tags.html#python-ref">python <span>6</span></a></li>
     
    	<li><a href="http://CatherineH.github.io/tags.html#windows-ref">windows <span>1</span></a></li>
     
    	<li><a href="http://CatherineH.github.io/tags.html#troubleshooting-ref">troubleshooting <span>1</span></a></li>
    
  



    </ul>
    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="http://CatherineH.github.io/programming/2016/06/07/mimicking-udev-rules-with-pyserial" title="Mimicking udev rules with PySerial">&laquo; Previous</a></li>
    
      <li><a href="http://CatherineH.github.io/archive.html">Archive</a></li>
    
      <li class="next disabled"><a>Next &rarr;</a>
    
    </ul>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'catherineh'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2016 Catherine Holloway
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
        </p>
      </div>
    </div>

    





    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

