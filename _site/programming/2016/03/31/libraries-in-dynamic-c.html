
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Libraries in Dynamic C</title>
    <meta name="description" content="The details to including .lib files in Dynamic C not included in the documentation">
    <meta name="author" content="Catherine Holloway">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap styles -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional theme -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Sticky Footer -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/css/bs-sticky-footer.css" rel="stylesheet">
    
    <!-- Custom styles -->
    <link href="http://CatherineH.github.io/assets/themes/bootstrap-3/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="http://CatherineH.github.io/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="http://CatherineH.github.io/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div id="wrap">
      <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#jb-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Catherine's Auxiliary Brain</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="jb-navbar-collapse">
          <ul class="nav navbar-nav">
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/categories">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/pages">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="http://CatherineH.github.io/tags">Tags</a></li>
      	
      
    
  



          </ul>
          <form class="navbar-form navbar-right" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

      <div class="container">
        
<div class="page-header">
  <h1>Libraries in Dynamic C </h1>
</div>

<div class="row post-full">
  <div class="col-xs-12">
    <div class="date">
      <span>31 March 2016</span>
    </div>
    <div class="content">
      
<p>2000+ line <strong>main</strong> functions are no fun, but Dynamic C does not make
modularization easy. In this post, I’ll document all of the details of using
library functions and the problems I’ve encountered using them.</p>

<h1 id="linking-libraries">Linking Libraries</h1>

<p>The Dynamic C compiler will look for libraries in the directory structure
detailed in the file <strong>C:\DCRABBIT_XX\LIB.DIR</strong>. After a default
installation, this file will point towards <strong>C:\DCRABBIT_XX\LIB</strong> and certain
 <strong>SAMPLES</strong> directories. Since <strong>C:\DCRABBIT_XX</strong> is read-only, I prefer to
 create a link between the location of my source and the
 <strong>C:\DCRABBIT_XX\LIB</strong> directory, rather than either copying the files to
 this directory or editing the <strong>LIB.DIR</strong>. On Windows, this can be done using:</p>

<pre><code>mklink C:\DCRabbit_9.62\Lib\starship.lib
C:\Users\catherine\Rabbit3400\lib\starship.lib
</code></pre>

<p>This needs to be done as administrator, which can either be done by running
the command prompt as administrator, or by using runas:</p>

<pre><code>runas /noprofile /user:pink-beast-windows\catherine "mklink C:\DCRabbit_9
.62\Lib\starship.lib C:\Users\catherine\Rabbit3400\lib\starship.lib"
</code></pre>

<p>However, this results in the error:</p>

<pre><code>The system cannot find the file specified.
</code></pre>
<p>and my windows-file-system-fu is not strong enough to figure out what I’m
doing wrong. Maybe when ubuntu comes to windows 10 I’ll be able to ignore my
ignorance.</p>

<h1 id="a-sample-library">A Sample Library</h1>

<p>The following is an example project in Dynamic C with two libraries. The
first library is called <em>starship.lib</em> and contains the source:</p>

<pre><code>/*** BeginHeader StarshipCrew */
struct StarshipCrew{
    char captain[10];
    char first_officer[10];
    char chief_engineer[10];
    char chief_medical_officer[10];
};
/*** EndHeader */
</code></pre>
<p>The second library is called <em>starship_functions.lib</em> and contains the source:</p>

<pre><code>/*** BeginHeader assignCaptain */
void assignCaptain(struct StarshipCrew * starship, char * captain);
/*** EndHeader */
void assignCaptain(struct StarshipCrew * starship, char * captain)
{
    sprintf(starship-&gt;captain, "%s", captain);
}
</code></pre>
<p>And main looks like this:</p>

<pre><code>#use "starship.lib"
#use "starship_functions.lib"

main(){
    struct StarshipCrew enterprise;
    char captain[10];
    sprintf(captain, "Picard");
    assignCaptain(&amp;enterprise, captain);
    printf("Captain of the Enterprise is %s\n", enterprise.captain);
}
</code></pre>
<p>This program compiles correctly once the links to the libraries are created
in the library directory.</p>

<h1 id="troubleshooting">Troubleshooting</h1>

<p>Although I’ve just shown you works, there are many, many ways that libraries
can be broken, and the compiler messages are not terribly useful.</p>

<h2 id="use-statements-do-not-chain">#use statements do not chain</h2>

<p>If you move the <em>#use “starship.lib”</em> line to the <em>starship_functions.lib</em>,
the main won’t be able to find the struct definition. The compiler will
report the error:</p>

<pre><code>line    5 : ERROR a_starship_test.c   : Struct use before definition.
line    9 : ERROR a_starship_test.c   : ) is missing/expected.
line    9 : ERROR a_starship_test.c   : Invalid struct reference.
</code></pre>

<p><strong>Solution</strong></p>

<p>Keep all use statements in your main() file.</p>

<h2 id="missing-beginheader-statements">Missing BeginHeader statements</h2>

<p>Although they look superfluous, the <em>BeginHeader</em> statements are essential.
Without the BeginHeader statement on the struct, this will create the error:</p>

<pre><code>line    4 : ERROR a_starship_test.c   : Struct use before definition.
line    8 : ERROR a_starship_test.c   : ) is missing/expected.
line    8 : ERROR a_starship_test.c   : Invalid struct reference.
</code></pre>

<p>Without the BeginHeader statement on the function, the error is:</p>

<pre><code>line    7 : WARNING a_starship_test.c   : Reference to 'assignCaptain' has no corresponding prototype.
line    7 : ERROR a_starship_test.c   : Undefined (but used) global label assignCaptain
</code></pre>

<p>It is important that the function name matches the function. For example, if
the <em>BeginHeader</em> statement is changed to:</p>

<pre><code>/*** BeginHeader assignCap */
void assignCaptain(struct StarshipCrew * starship, char * captain);
/*** EndHeader */
</code></pre>
<p>Then the compiler error is:</p>

<pre><code>line    2 : ERROR STARSHIP_FUNCTIONS.LIB   : Undefined (but used) global label assignCaptain
</code></pre>

<p><strong>Solution</strong></p>

<p>All structs, typedefs and functions need <em>BeginHeader functionName</em> statement
 around the prototype, and <em>functionName</em> must match the struct or function
 name.</p>

<h2 id="cleaning-out-compiled-libraries">Cleaning out compiled libraries</h2>

<p>When a program with the <em>#use</em> statement is compiled, the compiler will look
for the compiled library files for the used library. These are the files with
 the extension <em>HX1</em> and <em>MD1</em>. If it can’t find these files, it will first
 compile the library, if it does find the files, it will ignore the <em>lib</em>
 file. This means that if you fix an error in your <em>lib</em> file, the next time
 you compile your project, you will get the <em>super helpful</em> error of:</p>

<pre><code>line    2 : ERROR STARSHIP_FUNCTIONS.LIB   : Need function definition or declaration.
line    2 : ERROR STARSHIP_FUNCTIONS.LIB   : Syntax error - or garbage at end of program.
</code></pre>

<p><strong>Solution</strong></p>

<p>Before compiling your program, delete the HX1 and MD1 files for each library
changed.</p>

<h2 id="order-of-import-errors">Order of Import Errors</h2>

<p>I’m not sure exactly how to replicate this error, but I have occasionally
encountered compiler errors like this:</p>

<pre><code>line  333 : ERROR LCD_FUNCTIONS.LIB   : Redefinition of parameter 1 different.
</code></pre>

<p>I’m not sure what causes this, but it typically happens when a library
function uses a struct defined in another library, and this library is
imported before the library with the function is imported in the <em>main()</em>
function.</p>

<p><strong>Solution</strong></p>

<p>I’ve fixed this error by switching the order of imports from:</p>

<pre><code>#use "lcd_functions.lib"
#use "library_with_struct.lib"
</code></pre>

<p>to:</p>

<pre><code>#use "library_with_struct.lib"
#use "lcd_functions.lib"
</code></pre>


    </div>

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-open"></i></li>
      
      


  
     
    	<li><a href="http://CatherineH.github.io/categories.html#programming-ref">
    		programming <span>9</span>
    	</a></li>
    
  


    </ul>
    

  
    <ul class="tag_box inline">
      <li><i class="glyphicon glyphicon-tags"></i></li>
      
      


  
     
    	<li><a href="http://CatherineH.github.io/tags.html#c-ref">c <span>2</span></a></li>
     
    	<li><a href="http://CatherineH.github.io/tags.html#dynamic c-ref">dynamic c <span>2</span></a></li>
    
  



    </ul>
    
  
    <hr>
    <ul class="pagination">
    
      <li class="prev"><a href="http://CatherineH.github.io/programming/2016/03/30/no-malloc-no-problem" title="No malloc, No problem">&laquo; Previous</a></li>
    
      <li><a href="http://CatherineH.github.io/archive.html">Archive</a></li>
    
      <li class="next"><a href="http://CatherineH.github.io/music/2016/04/11/vikings-in-hungary" title="Vikings in Hungary">Next &raquo;</a></li>
    
    </ul>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    
    var disqus_developer = 1;
    var disqus_shortname = 'catherineh'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>

    </div>

    <div id="footer">
      <div class="container">
        <p>&copy; 2016 Catherine Holloway
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>
        </p>
      </div>
    </div>

    





    <!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://CatherineH.github.io/assets/themes/bootstrap-3/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>

